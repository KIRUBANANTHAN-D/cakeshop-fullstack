<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FB CAKES - Orders</title>
  <link rel="stylesheet" href="CSS/order.css">
</head>

<body>

  <!-- NAVBAR -->
  <nav>
    <div class="logo">FB CAKES</div>
    <ul>
      <li><a href="home.html">Home</a></li>
      <li><a href="menu.html">Menu</a></li>
      <li><a href="contect.html">Contect</a></li>
      <li><a href="order.html" class="active">Orders</a></li>
    </ul>
  </nav>

  <h1 style="color:#333; text-align:center;"><b>Customer Orders</b></h1>

  <div id="orderList" class="order-list"></div>

  <script>
    let editIndex = null;

    function loadOrders() {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let container = document.getElementById("orderList");
      container.innerHTML = "";

      if (orders.length === 0) {
        container.innerHTML = `<p class='no-orders'>No orders placed yet.</p>`;
        return;
      }

      orders.forEach((o, index) => {
        let box = document.createElement("div");
        box.className = "order-item";

        box.innerHTML = `
          <p><b>Bill No:</b> ${o.billNo}</p>
          <p><b>Flovour:</b> ${o.name}</p>
          <p><b>Weight:</b> ${o.size} kg</p>
          <p><b>Price:</b> Rs. ${o.price}</p>
          <p><b>Message:</b> ${o.msg || "-"}</p>
          <p><b>Notes:</b> ${o.notes || "-"}</p>

          <hr>

          <p><b>Customer:</b> ${o.customerName}</p>
          <p><b>Phone:</b> ${o.customerPhone}</p>
          <p><b>Branch:</b> ${o.branch}</p>
          <p><b>Pickup/Delivery:</b> ${o.type}</p>
          ${o.address ? `<p><b>Address:</b> ${o.address}</p>` : ""}

          <p><b>Date:</b> ${o.time.split("T")[0]}</p>
          <p><b>Time:</b> ${o.time.split("T")[1]}</p>

          <hr>

          <p><b>Payment:</b> ${o.method}</p>
          <p><b>Order status:</b> 
            <span id="status-${index}" style="color:${o.status === "Cancelled" ? "red" : "green"};">
              ${o.status || "Confirmed"}
            </span>
          </p>

          <button class="change-btn" onclick="openEdit(${index})">Change</button>

          <button id="cancel-${index}" class="cancelBtn" ${o.status === "Cancelled" ? "disabled" : ""}>
            ${o.status === "Cancelled" ? "Cancelled" : "Cancel Order"}
          </button>

          <button id="delete-${index}" class="deleteBtn" style="background:red; color:white;">
            Delete
          </button>

          <button id="print-${index}" class="deleteBtn" style="background:green; color:white;">
            Print Bill
          </button>
        `;

        container.appendChild(box);

        // CANCEL
        document.getElementById(`cancel-${index}`).onclick = function () {
          if (confirm("Cancel this order?")) {
            orders[index].status = "Cancelled";
            localStorage.setItem("orders", JSON.stringify(orders));

            document.getElementById(`status-${index}`).innerText = "Cancelled";
            document.getElementById(`status-${index}`).style.color = "red";

            this.innerText = "Cancelled";
            this.disabled = true;
          }
        };

        // DELETE
        document.getElementById(`delete-${index}`).onclick = function () {
          if (confirm("Delete this order permanently?")) {
            orders.splice(index, 1);
            localStorage.setItem("orders", JSON.stringify(orders));
            loadOrders();
          }
        };

        // PRINT
        document.getElementById(`print-${index}`).onclick = function () {
            document.getElementById("pBill").innerText = o.billNo;
            document.getElementById("pname").innerText = o.name;
            document.getElementById("psize").innerText = o.size + " Kg";
            document.getElementById("pPrice").innerText = o.price;
            document.getElementById("pMsg").innerText = o.msg;
            document.getElementById("pNotes").innerText = o.notes;
            document.getElementById("pCust").innerText = o.customerName;
            document.getElementById("pPhone").innerText = o.customerPhone;
            document.getElementById("pBranch").innerText = o.branch;
          window.print();
        };
      });
    }

    // EDIT OPEN
    function openEdit(index) {
      editIndex = index;

      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let o = orders[index];

      document.getElementById("editName").value = o.cakeName;
      document.getElementById("editSize").value = o.size;
      document.getElementById("editPrice").value = o.price;
      document.getElementById("editBranch").value = o.branch;

      document.getElementById("editPopup").style.display = "flex";
    }

    // SAVE EDIT
    function saveEdit() {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];

      orders[editIndex].cakeName = document.getElementById("editName").value;
      orders[editIndex].size = document.getElementById("editSize").value;
      orders[editIndex].price = document.getElementById("editPrice").value;
      orders[editIndex].branch = document.getElementById("editBranch").value;

      localStorage.setItem("orders", JSON.stringify(orders));
      closeEdit();
      loadOrders();
    }

    function closeEdit() {
      document.getElementById("editPopup").style.display = "none";
    }

    loadOrders();
  </script>

  <!-- EDIT POPUP -->
  <div id="editPopup" class="edit-popup">
    <div class="edit-box">
      <h2>Edit Order</h2>

      <label>Cake Name</label>
      <input type="text" id="editName">

      <label>Size (Kg)</label>
      <input type="text" id="editSize">

      <label>Price</label>
      <input type="text" id="editPrice">

      <label>Branch</label>
      <input type="text" id="editBranch">

      <button onclick="saveEdit()" class="saveBtn">Save Changes</button>
      <button onclick="closeEdit()" class="closeBtn">Close</button>
    </div>
  </div>

  <!-- bill print-->
  <div id="print-bill" class="print-area">
    <h1>FB CAKES </h1>
    <h2><b>Bill No:</b> <span id="pBill"></span></h2>
    <h3><b>Flovour:</b> <span id="pname"></span></h3>
    <h3><b>Size:</b> <span id="psize"></span></h3>
    <h3><b>Price:</b> <span id="pPrice"></span></h3>
    <h3><b>Notes:</b> <span id="pNotes"></span></h3>
    <h3><b>Customer:</b> <span id="pCust"></span></h3>
    <h3><b>Phone:</b> <span id="pPhone"></span></h3>
    <h3><b>Branch:</b> <span id="pBranch"></span></h3>
    <h3><b>Message:</b> <span id="pMsg"></span></h3>
  </div>


  <!-- FOOTER -->

  <footer style="background:#ec0cda; color:white; text-align:center; padding:20px; margin-top:30px;">
    Â© 2025 FB CAKES
  </footer>

</body>
</html>
